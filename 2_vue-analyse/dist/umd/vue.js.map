{"version":3,"file":"vue.js","sources":["../../src/observer/array.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["const oldArrayProtoMethods = Array.prototype\n\nconst arrayMethods = Object.create(oldArrayProtoMethods)\n\nconst methods = ['push', 'pop', 'shift', 'unshift', 'splice', 'sort', 'reverse']\n\nmethods.forEach(method => {\n  //AOP\n  // 重写数组方法\n  arrayMethods[method] = function (...args) {\n    const result = oldArrayProtoMethods[method].call(this, ...args)\n    console.log('数组变化')\n    return result\n  }\n})\n\nexport { arrayMethods }\n","import { arrayMethods } from './array'\n\nfunction defineReactive(data, key, value) {\n  observe(value) // 对结果，递归拦截\n\n  Object.defineProperty(data, key, {\n    get() {\n      return value\n    },\n    set(nValue) {\n      if (nValue === value) return\n      observe(nValue)\n      value = nValue\n    },\n  })\n}\n\nclass Observer {\n  constructor(value) {\n    if (Array.isArray(value)) {\n      // value.__proto__ = arrayMethods\n      Object.setPrototypeOf(value, arrayMethods)\n      this.observeArray(value)\n    } else {\n      this.walk(value)\n    }\n  }\n\n  walk(data) {\n    Object.keys(data).forEach(key => {\n      const val = data[key]\n      defineReactive(data, key, val)\n    })\n  }\n\n  observeArray(arr) {\n    for (let i = 0; i < arr.length; i++) {\n      observe(arr[i])\n    }\n  }\n}\n\nfunction observe(data) {\n  if (typeof data !== 'object' || data == null) return\n  return new Observer(data)\n}\n\nexport { observe }\n","import { observe } from './observer/index'\n\nfunction initState(vm) {\n  // 将所有的数据定义在vm上，后续更改时，触发试图的更新\n  const opts = vm.$options\n  if (opts.data) {\n    initData(vm)\n  }\n}\n\nfunction proxy(vm, source, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[source][key]\n    },\n    set(nValue) {\n      vm[source][key] = nValue\n    },\n  })\n}\n\nfunction initData(vm) {\n  let data = vm.$options.data\n  data = vm._data = typeof data === 'function' ? data.call(vm) : data\n\n  for (const dataKey in data) {\n    proxy(vm, '_data', dataKey)\n  }\n\n  // 观测数据\n  observe(data)\n}\n\nexport { initState }\n","import { initState } from \"./state\";\n\nfunction initMixin(Vue) {\n  // Vue的初始化\n  Vue.prototype._init = function (options) {\n    const vm = this\n    vm.$options = options\n    initState(vm)\n  }\n}\n\nexport { initMixin }\n","import { initMixin } from \"./init\";\n\nfunction Vue(options) {\n  this._init(options)\n}\n\ninitMixin(Vue)\n\nexport default Vue\n"],"names":["oldArrayProtoMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","result","call","console","log","defineReactive","data","key","value","observe","defineProperty","get","set","nValue","Observer","isArray","setPrototypeOf","observeArray","walk","keys","val","arr","i","length","initState","vm","opts","$options","initData","proxy","source","_data","dataKey","initMixin","Vue","_init","options"],"mappings":"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"}