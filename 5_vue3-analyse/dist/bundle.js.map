{"version":3,"file":"bundle.js","sources":["../src/utils/index.ts","../src/reactivity/effect.ts","../src/reactivity/baseHandler.ts","../src/reactivity/reactive.ts","../src/reactivity/computed.ts","../src/reactivity/ref.ts","../src/runtim-core/apiCreateApp.ts","../src/runtim-core/renderer.ts","../src/runtime-dom/index.ts"],"sourcesContent":["export function isObject(obj): boolean {\r\n  return typeof obj === 'object' && obj != null\r\n}\r\n\r\nconst hasOwnProperty = Object.prototype.hasOwnProperty\r\n\r\nexport function hasOwn(target, key): boolean {\r\n  return hasOwnProperty.call(target, key)\r\n}\r\n\r\nexport function isArray(arr): boolean {\r\n  return Array.isArray(arr)\r\n}\r\n\r\nexport function hasChange(v1, v2): boolean {\r\n  return v1 !== v2\r\n}\r\n\r\nexport function isFunction(fun): boolean {\r\n  return typeof fun === 'function'\r\n}\r\n","import { isArray } from '../utils'\n\nconst effectStack: Function[] = []\nlet currentEffect: Function | null = null\n\nfunction createReactiveEffect(fun, opts) {\n  const effect = function () {\n    if (!effectStack.includes(effect)) {\n      try {\n        effectStack.push(effect)\n        currentEffect = effect\n        return fun()\n      } finally {\n        effectStack.pop()\n        currentEffect = effectStack[effectStack.length - 1]\n      }\n    }\n  }\n  effect.options = opts\n  return effect\n}\n\nfunction effect(fun, opts) {\n  const ef = createReactiveEffect(fun, opts)\n  if (!opts?.lazy) {\n    ef()\n  }\n\n  return ef\n}\n\n// 建立 属性和effect之间的关联（对应Vue2中的dep和watcher）\nconst targetMap = new WeakMap()\n\nfunction track(target, key) {\n  if (currentEffect == undefined) return\n  let depsMap = targetMap.get(target)\n  if (!depsMap) {\n    targetMap.set(target, (depsMap = new Map()))\n  }\n  let dep = depsMap.get(key)\n  if (!dep) {\n    depsMap.set(key, (dep = new Set()))\n  }\n  if (!dep.has(currentEffect)) {\n    dep.add(currentEffect)\n  }\n}\n\nconst run = effects => {\n  if (effects)\n    effects.forEach(effect => {\n      // 1. 渲染对应的effect 2. 计算属性对应的effect\n      if (effect.options?.scheduler) {\n        effect.options.scheduler(effect)\n      }else {\n        effect()\n      }\n    })\n}\n\nfunction trigger(target, type, key, value?) {\n  const depsMap = targetMap.get(target)\n  if (!depsMap) return\n\n  if (key === 'length' && isArray(target)) {\n    depsMap.forEach((dep, k) => {\n      // 如果改变了数组长度，触发更新\n      if (k === 'length' || k >= value) run(dep)\n    })\n    return\n  }\n\n  // 修改\n  if (key != undefined) {\n    const effects = depsMap.get(key)\n    run(effects)\n  }\n\n  // 添加\n  switch (type) {\n    case 'add':\n      if (isArray(target)) {\n        if (parseInt(key) + '' === key) {\n          run(depsMap.get('length'))\n        }\n      }\n      break\n    default:\n      break\n  }\n}\n\nexport { effect, effectStack, currentEffect, track, trigger }\n","import { track, trigger } from './effect'\nimport { hasChange, hasOwn, isArray, isObject } from '../utils'\nimport { reactive } from './reactive'\n\nconst mutableHandlers = {\n  get(target, key, recevier) {\n    const res = Reflect.get(target, key, recevier)\n\n    if (typeof key === 'symbol') return res\n    // 依赖收集\n    track(target, key)\n\n    if (res.__v_isRef) return res.value\n\n    // 取值如果是对象，递归代理（懒代理）\n    return isObject(res) ? reactive(res) : res\n  },\n  set(target, key, value, recevier) {\n    const oldVal = target[key]\n\n    // 判断是否新增属性\n    const hadKey = isArray(target) && parseInt(key, 10) + '' === key ? Number(key) < target.length : hasOwn(target, key)\n\n    const res = Reflect.set(target, key, value, recevier)\n\n    if (!hadKey) {\n      // 新增属性\n      trigger(target, 'add', key, value)\n    } else if (hasChange(oldVal, value)) {\n      // 修改属性\n      trigger(target, 'set', key, value)\n    }\n\n    return res\n  },\n}\n\nexport {\n  mutableHandlers\n}\n","import {isObject} from \"../utils\";\r\nimport {mutableHandlers} from \"./baseHandler\";\r\n\r\nconst reactiveMap = new WeakMap()\r\n\r\nfunction createReactiveObject(target, baseHandler) {\r\n  if (!isObject(target)) return target\r\n  if (!reactiveMap.has(target)) {\r\n    const proxy = new Proxy(target, baseHandler)\r\n    reactiveMap.set(target, proxy)\r\n    return proxy\r\n  }\r\n  return reactiveMap.get(target)\r\n}\r\n\r\nfunction reactive(target) {\r\n  return createReactiveObject(target, mutableHandlers)\r\n}\r\n\r\nexport {\r\n  reactive\r\n}\r\n","import { isFunction } from '../utils'\nimport { effect, track, trigger } from './effect'\n\nclass ComputedRefImpl {\n  private effect\n  private __v_isReadonly = true\n  private __v_isRef = true\n  private _dirty = true // 缓存控制\n  private _value\n\n  constructor(getter, public setter) {\n    this.effect = effect(getter, {\n      lazy: true,\n      scheduler: effect => {\n        this._dirty = true\n        trigger(this, 'set', 'value')\n      },\n    })\n  }\n\n  get value() {\n    if (this._dirty) {\n      this._value = this.effect()\n      track(this, 'value')\n      this._dirty = false\n    }\n    return this._value\n  }\n\n  set value(val) {\n    this.setter(val)\n  }\n}\n\nfunction computed(getterOrOptions) {\n  let getter\n  let setter\n\n  if (isFunction(getterOrOptions)) {\n    getter = getterOrOptions\n    setter = () => console.log('computed not set value')\n  } else {\n    getter = getterOrOptions.get\n    setter = getterOrOptions.set\n  }\n\n  return new ComputedRefImpl(getter, setter)\n}\n\nexport { computed }\n","import { hasChange, isArray, isObject } from '../utils'\nimport { reactive } from './reactive'\nimport { track, trigger } from './effect'\n\nclass RefImpl {\n  private __v_isReadonly = true\n  private __v_isRef = true\n\n  constructor(public rawValue) {}\n\n  get value() {\n    track(this, 'value')\n    return convert(this.rawValue)\n  }\n\n  set value(val) {\n    if (hasChange(val, this.rawValue)) {\n      this.rawValue = convert(val)\n      trigger(this, 'set', 'value')\n    }\n  }\n}\n\nfunction convert(val) {\n  return isObject(val) ? reactive(val) : val\n}\n\nfunction ref(rawValue) {\n  return new RefImpl(rawValue)\n}\n\nclass ObjectRefImpl {\n  constructor(public obj, public key) {}\n\n  get value() {\n    return this.obj[this.key]\n  }\n\n  set value(val) {\n    this.obj[this.key] = val\n  }\n}\n\nfunction toRefs(obj) {\n  const res = isArray(obj) ? new Array(obj.length) : {}\n  for (const objKey in obj) {\n    if (obj.hasOwnProperty(objKey)) res[objKey] = new ObjectRefImpl(obj, objKey)\n  }\n  return res\n}\n\nexport { ref, toRefs }\n","function apiCreateApp(render) {\n  return component => {\n    const app = {\n      mount: container => {},\n    }\n\n    return app\n  }\n}\n\nexport { apiCreateApp }\n","import { apiCreateApp } from './apiCreateApp'\n\nfunction createRender(options) {\n\n  const render = () => {}\n  return {\n    createApp: apiCreateApp(render),\n  }\n}\n\nexport { createRender }\n","import { createRender } from '../runtim-core'\nimport { nodeOpts } from './nodeOpts'\nimport { patchProp } from './patchProp'\n\nfunction ensureRender() {\n  return createRender({ ...nodeOpts, patchProp })\n}\n\nfunction createApp(rootComponent) {\n  // rootComponent = app\n  const app = ensureRender().createApp(rootComponent)\n  const { mount } = app\n  app.mount = function (el) {\n    el = typeof el === 'string' ? document.querySelector(el) : el\n    el.innerHTML = ''\n    mount(el)\n  }\n  return {\n    mount,\n  }\n}\n\nexport { createApp }\n"],"names":[],"mappings":"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"}